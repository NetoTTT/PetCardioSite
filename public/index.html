<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login e Cadastro com Firebase</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Firebase SDK compatível com scripts sem "type=module" -->
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
</head>

<body class="bg-light">
  <div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow-lg p-4" style="width: 100%; max-width: 400px">
      <!-- Abas para alternar entre login e cadastro -->
      <!-- Abas para alternar entre login e cadastro -->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button"
            role="tab" aria-controls="login" aria-selected="true">
            Login
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button"
            role="tab" aria-controls="signup" aria-selected="false">
            Cadastro
          </button>
        </li>
      </ul>

      <!-- Conteúdo das abas -->
      <div class="tab-content" id="myTabContent">
        <!-- Formulário de Login -->
        <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
          <form id="loginForm" class="mt-4">
            <div class="mb-3">
              <label for="loginEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="loginEmail" placeholder="Digite seu email" required />
            </div>
            <div class="mb-3">
              <label for="loginPassword" class="form-label">Senha</label>
              <input type="password" class="form-control" id="loginPassword" placeholder="Digite sua senha" required />
            </div>
            <button type="submit" class="btn btn-primary w-100">
              Entrar
            </button>
            <p class="mt-2 text-danger" id="loginError"></p>
          </form>
        </div>

        <!-- Formulário de Cadastro -->
        <div class="tab-pane fade" id="signup" role="tabpanel" aria-labelledby="signup-tab">
          <form id="signupForm" class="mt-4">
            <div class="mb-3">
              <label for="signupName" class="form-label">Nome</label>
              <input type="text" class="form-control" id="signupName" placeholder="Digite seu nome" required />
            </div>
            <div class="mb-3">
              <label for="signupEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="signupEmail" placeholder="Digite seu email" required />
            </div>
            <div class="mb-3">
              <label for="signupPassword" class="form-label">Senha</label>
              <input type="password" class="form-control" id="signupPassword" placeholder="Digite sua senha" required />
            </div>
            <button type="submit" class="btn btn-success w-100">
              Cadastrar
            </button>
            <p class="mt-2 text-danger" id="signupError"></p>
          </form>
        </div>
      </div>
      <!-- ... (HTML das abas) ... -->
    </div>
    <!-- Modal de feedback -->
    <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="feedbackModalLabel">Feedback</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="feedbackMessage">
            <!-- A mensagem será inserida dinamicamente aqui -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Configurações do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD-1Jy98ZHXn6NWy8X3OPYlEg6f9NAIqEE",
      authDomain: "petcardio-9cabf.firebaseapp.com",
      databaseURL: "https://petcardio-9cabf-default-rtdb.firebaseio.com",
      projectId: "petcardio-9cabf",
      storageBucket: "petcardio-9cabf.appspot.com",
      messagingSenderId: "409087895827",
      appId: "1:409087895827:web:aba715782324516f8e52e6",
      measurementId: "G-P0ZM04MDS5"
    };

    // Inicializar o Firebase
    firebase.initializeApp(firebaseConfig);
    // Função para exibir o feedback no modal
    function showFeedbackMessage(message, type = 'success') {
      const feedbackMessage = document.getElementById("feedbackMessage");
      feedbackMessage.textContent = message;

      // Muda a classe do modal com base no tipo (sucesso ou erro)
      if (type === 'error') {
        feedbackMessage.style.color = 'red';
      } else {
        feedbackMessage.style.color = 'green';
      }

      // Exibir o modal
      const feedbackModal = new bootstrap.Modal(document.getElementById('feedbackModal'));
      feedbackModal.show();
    }

    // Função de cadastro
    document.getElementById("signupForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("signupEmail").value;
      const password = document.getElementById("signupPassword").value;

      fetch("https://server-api-petcardio-production.up.railway.app/signup", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ email, password }),
      })
        .then((response) => {
          if (!response.ok) {
            return response.json().then((data) => {
              throw new Error(data.message || "Erro desconhecido no cadastro");
            });
          }
          return response.json();
        })
        .then((data) => {
          showFeedbackMessage("Cadastro realizado com sucesso!");
          document.getElementById("signupForm").reset();
        })
        .catch((error) => {
          showFeedbackMessage(error.message, 'error');
        });
    });

    // Função de login
    document.getElementById("loginForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;

      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          return userCredential.user.getIdToken();
        })
        .then((token) => {
          return fetch("https://server-api-petcardio-production.up.railway.app/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ token }),
          });
        })
        .then((response) => response.json())
        .then((data) => {
          showFeedbackMessage("Login realizado com sucesso!");
          document.getElementById("loginForm").reset();

          // Redirecionar para outra página após o login
          window.location.href = "/painel/painel.html";
        })
        .catch((error) => {
          showFeedbackMessage(error.message, 'error');
        });
    });

  </script>
</body>

</html>